const catalogItems = [
	{
		catalogItemTitle: 'Реклама и бизнес',
		catalogItemIcon: 'img/catalog-icons/01.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Промышленные мониторы',
				catalogItemElementSlug: 'industrial-monitors',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'КСО (кассы самообслуживания)',
				catalogItemElementSlug: 'self-service-checkouts',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Киоски',
				catalogItemElementSlug: 'kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Уличные мониторы',
				catalogItemElementSlug: 'street-monitors',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Государственные компании',
		catalogItemIcon: 'img/catalog-icons/02.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Промышленные мониторы',
				catalogItemElementSlug: 'industrial-monitors',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Киоски',
				catalogItemElementSlug: 'kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Уличные мониторы',
				catalogItemElementSlug: 'street-monitors',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Образование',
		catalogItemIcon: 'img/catalog-icons/03.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Интерактивные панели',
				catalogItemElementSlug: 'interactive panels',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Доски',
				catalogItemElementSlug: 'boards',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Ритейл и сфера продаж',
		catalogItemIcon: 'img/catalog-icons/04.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Промышленные мониторы',
				catalogItemElementSlug: 'industrial-monitors',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Доски',
				catalogItemElementSlug: 'boards',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Панели',
				catalogItemElementSlug: 'panels',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Производственные предприятия',
		catalogItemIcon: 'img/catalog-icons/05.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Видеостены',
				catalogItemElementSlug: 'video-walls',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Промышленные мониторы',
				catalogItemElementSlug: 'industrial-monitors',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Салоны красоты и парикмахерские',
		catalogItemIcon: 'img/catalog-icons/06.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Панели',
				catalogItemElementSlug: 'panels',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Планшеты на ножке',
				catalogItemElementSlug: 'tablets-on-a-stalk',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Медицина',
		catalogItemIcon: 'img/catalog-icons/07.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Столы',
				catalogItemElementSlug: 'tables',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Панели',
				catalogItemElementSlug: 'panels',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Киоски',
				catalogItemElementSlug: 'kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Терминал самообслуживания',
				catalogItemElementSlug: 'self-service-terminal',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Интерактивный музей',
		catalogItemIcon: 'img/catalog-icons/08.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Информационные коиски',
				catalogItemElementSlug: 'information-kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Интерактивне столы (прозрачные)',
				catalogItemElementSlug: 'interactive-tables-transparent',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Интерактивне столы (двухсторонние)',
				catalogItemElementSlug: 'interactive-tables-two-sided',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Рестораны и общепит',
		catalogItemIcon: 'img/catalog-icons/09.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Промышленные мониторы',
				catalogItemElementSlug: 'industrial-monitors',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'КСО (кассы самообслуживания)',
				catalogItemElementSlug: 'self-service-checkouts',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Киоски',
				catalogItemElementSlug: 'kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Уличные мониторы',
				catalogItemElementSlug: 'street-monitors',
				catalogItemElementExtra: ''
			}
		]
	},
	{
		catalogItemTitle: 'Автосалоны',
		catalogItemIcon: 'img/catalog-icons/10.svg',
		catalogItemElements: [
			{
				catalogItemElementName: '3D кабина',
				catalogItemElementSlug: '3D-cabin',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Видеостены',
				catalogItemElementSlug: 'video-walls',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Интерактивные киоски',
				catalogItemElementSlug: 'interactive-kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Информационные коиски',
				catalogItemElementSlug: 'information-kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Проекционная пленка (прозрачный)',
				catalogItemElementSlug: 'projection-film-transparent',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Проекционная пленка (светодиод)',
				catalogItemElementSlug: 'projection-film-led',
				catalogItemElementExtra: 'Хит'
			}
		]
	},
	{
		catalogItemTitle: 'Вокзалы и аэропорты',
		catalogItemIcon: 'img/catalog-icons/11.svg',
		catalogItemElements: [
			{
				catalogItemElementName: 'Киоски',
				catalogItemElementSlug: 'kiosks',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Столы',
				catalogItemElementSlug: 'tables',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Панели',
				catalogItemElementSlug: 'panels',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Видеостены',
				catalogItemElementSlug: 'video-walls',
				catalogItemElementExtra: ''
			},
			{
				catalogItemElementName: 'Изогнутые мониторы',
				catalogItemElementSlug: 'сurved-monitors',
				catalogItemElementExtra: ''
			}
		]
	},
]

const products = [
	{
		id: 1,
		name: "Киоск типа INGSCREEN K",
		description: "Сенсорный стол",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием.',
		article: "89776",
		images: [
			"img/products/02.png",
			"img/products/03.png",
			"img/products/04.png",
			"img/products/05.png"
		],
		price: 120000,
		category: "Сенсорные столы",
		tags: ["интерактивные", "сенсорные"],
		resolution: "1920x1080",
		os: "Windows 10",
		diagonal: "23 дюйма",
		brightness: "300 нит",
		displayTechnology: "IPS",
		features: {
			size: "1469x1062x38",
			weight: "20 кг",
			material: "металл/пластик"
		},
		certification: ["img/certificates/01.png", "img/certificates/02.png"]
	},
	{
		id: 3,
		name: "Киоск типа INGSCREEN L",
		description: "Интерактивное оборудование",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "54321",
		images: [
			"img/products/04.png",
			"img/products/06.png",
			"img/products/03.png"
		],
		price: 100000,
		category: "Киоски",
		tags: ["киоски", "оборудование"],
		resolution: "1366x768",
		os: "Linux",
		diagonal: "32 дюйма",
		brightness: "400 нит",
		displayTechnology: "AMOLED",
		features: {
			size: "900x600x50",
			weight: "15 кг",
			material: "пластик"
		},
		certification: ["img/certificates/04.png", "img/certificates/05.png"]
	},
	{
		id: 4,
		name: "Киоск типа INGSCREEN X",
		description: "Мультимедийный киоск",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "67890",
		images: ["img/products/01.png", "img/products/02.png"],
		price: 130000,
		category: "Мультимедиа",
		tags: ["киоски", "мультимедиа"],
		resolution: "2560x1440",
		os: "Windows 11",
		diagonal: "27 дюймов",
		brightness: "350 нит",
		displayTechnology: "IPS",
		features: {
			size: "1000x800x45",
			weight: "22 кг",
			material: "металл"
		},
		certification: ["img/certificates/02.png"]
	},
	{
		id: 5,
		name: "Киоск типа INGSCREEN V",
		description: "Вертикальный дисплей",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "98765",
		images: ["img/products/03.png"],
		price: 140000,
		category: "Интерактивные панели",
		tags: ["интерактивные", "вертикальные"],
		resolution: "1920x1200",
		os: "Android",
		diagonal: "30 дюймов",
		brightness: "450 нит",
		displayTechnology: "OLED",
		features: {
			size: "1200x700x40",
			weight: "20 кг",
			material: "алюминий/стекло"
		},
		certification: ["img/certificates/01.png", "img/certificates/04.png"]
	},
	{
		id: 6,
		name: "Киоск типа INGSCREEN Pro",
		description: "Высококачественный дисплей",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "11223",
		images: ["img/products/05.png", "img/products/06.png"],
		price: 180000,
		category: "Профессиональные дисплеи",
		tags: ["профессиональные", "высокое разрешение"],
		resolution: "3840x2160",
		os: "Windows 10",
		diagonal: "65 дюймов",
		brightness: "700 нит",
		displayTechnology: "AMOLED",
		features: {
			size: "1500x1000x50",
			weight: "30 кг",
			material: "металл/пластик"
		},
		certification: ["img/certificates/03.png", "img/certificates/05.png"]
	},
	{
		id: 7,
		name: "Киоск типа INGSCREEN Lite",
		description: "Экономичный вариант",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "99887",
		images: ["img/products/01.png"],
		price: 80000,
		category: "Экономичные киоски",
		tags: ["экономичный", "легкий"],
		resolution: "1280x720",
		os: "Linux",
		diagonal: "22 дюйма",
		brightness: "200 нит",
		displayTechnology: "TN",
		features: {
			size: "800x600x30",
			weight: "12 кг",
			material: "пластик"
		},
		certification: ["img/certificates/02.png"]
	},
	{
		id: 8,
		name: "Киоск типа INGSCREEN Ultra",
		description: "Ультратонкий дисплей",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "22334",
		images: ["img/products/04.png", "img/products/02.png"],
		price: 200000,
		category: "Ультратонкие дисплеи",
		tags: ["ультратонкий", "премиум"],
		resolution: "5120x2880",
		os: "Windows 11",
		diagonal: "75 дюймов",
		brightness: "800 нит",
		displayTechnology: "IPS",
		features: {
			size: "2000x1200x20",
			weight: "40 кг",
			material: "алюминий"
		},
		certification: ["img/certificates/03.png"]
	},
	{
		id: 9,
		name: "Киоск типа INGSCREEN Mini",
		description: "Компактный дисплей",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "44556",
		images: ["img/products/03.png"],
		price: 70000,
		category: "Компактные устройства",
		tags: ["компактный", "легкий"],
		resolution: "1600x900",
		os: "Android",
		diagonal: "19 дюймов",
		brightness: "250 нит",
		displayTechnology: "IPS",
		features: {
			size: "600x400x25",
			weight: "10 кг",
			material: "пластик"
		},
		certification: ["img/certificates/05.png"]
	},
	{
		id: 10,
		name: "Киоск типа INGSCREEN Max",
		description: "Максимальная производительность",
		descriptionText: 'Интерактивный информационный киоск представляет собой современное устройство с функцией сенсорного экрана и компьютерной интерактивной технологией, которое может выполнять запросы общественной информации и бизнес-обработку. Он оснащен сканером отпечатков пальцев, сканером, устройством считывания карт, микропринтером NFC, POS-машиной и другим оборудованием. ',
		article: "66778",
		images: ["img/products/06.png"],
		price: 250000,
		category: "Премиум сегмент",
		tags: ["премиум", "максимальная яркость"],
		resolution: "7680x4320",
		os: "Windows 11",
		diagonal: "85 дюймов",
		brightness: "1000 нит",
		displayTechnology: "AMOLED",
		features: {
			size: "2500x1500x60",
			weight: "50 кг",
			material: "металл/стекло"
		},
		certification: ["img/certificates/04.png", "img/certificates/02.png"]
	}
];


window.addEventListener('DOMContentLoaded', ready);

async function ready() {
	await loadPage();
	if (document.querySelector('.catalog-page')) {
		initCatalog();
		initViewType();
		catalogFlterMobile();
	}
	if (document.querySelector('.contacts-page')) {
		ymaps.ready(initMap);
	}
	if (document.querySelector('.product-page')) {
		downloadLogic();
	}
	video();
	form();
	anchors();
	dynamicAdapt();
	langSelect();
	scroll();
	headerMenu();
	searchHeader();
	catalogLogic();
	moveTitles();
	spollers();
	// renderSideBar(catalogItems);
	sideBarElements();
	// checkClick();
	// trackScroll();
	initSwipers();
	productSlider();
	window.addEventListener('resize', resize);
	window.addEventListener('scroll', scroll);
}

function handleResize() {
	const mediaQuery = window.matchMedia('(max-width: 860px)');
	mediaQuery.addEventListener('change', () => {
		moveTitles();
	});
}

function observeCatalogChanges() {
	const targetNode = document.querySelector('.catalog-container');
	if (!targetNode) return;

	const observer = new MutationObserver(() => {
		moveTitles();
	});

	const config = { childList: true, subtree: true };
	observer.observe(targetNode, config);
}

async function catalogLogic() {
	const catalogTriggers = document.querySelectorAll('.catalog-item');
	const catalogContainers = document.querySelectorAll('.catalog-container');
	const overlay = document.getElementById('overlay'); // Получаем оверлей

	catalogContainerWidth();

	// Генерация HTML для каталога
	// async function renderCatalog(items) {
	// 	return new Promise((resolve) => {
	// 		catalogContainers.forEach((catalogContainer) => {
	// 			catalogContainer.innerHTML = '';

	// 			items.forEach((item) => {
	// 				// Создаем элемент catalog-item-group
	// 				const group = document.createElement('div');
	// 				group.classList.add('catalog-item-group');

	// 				// Создаем структуру: иконка, заголовок, элементы
	// 				group.innerHTML = `
	//                     <div class="catalog-item-group__title-wrapper">
	//                         <div class="catalog-item-group__title">
	//                             <img src="${item.catalogItemIcon}" alt="${item.catalogItemTitle}">
	//                         </div>
	//                     </div>
	//                     <div class="catalog-item-group__content">
	//                         <div class="catalog-item-group-title">${item.catalogItemTitle}</div>
	//                         <div class="catalog-item-group-elems">
	//                             ${item.catalogItemElements.map(elem => `
	//                                 <a href="/catalog.php" class="catalog-item-group-elem">
	// 									<span>${elem.catalogItemElementName}</span>
	// 									${elem.catalogItemElementExtra
	// 						? `<span class="catalog-item-group-elem-extra">${elem.catalogItemElementExtra}</span>`
	// 						: ''
	// 					}
	// 								</a>
	//                             `).join('')}
	//                         </div>
	//                     </div>
	//                 `;
	// 				catalogContainer.appendChild(group);
	// 			});
	// 		});
	// 		resolve(); // Сообщаем, что рендеринг завершен
	// 	});
	// }

	// await renderCatalog(catalogItems);

	// Вызываем moveTitles после полной отрисовки DOM
	requestAnimationFrame(() => {
		moveTitles();
	});

	catalogTriggers.forEach((catalogTrigger) => {
		catalogTrigger.addEventListener('mouseenter', (e) => {
			catalogTrigger.querySelector('.catalog-container-wrapper').classList.add('show');
			overlay.classList.add('active');
		});

		catalogTrigger.addEventListener('mouseleave', (e) => {
			catalogTrigger.querySelector('.catalog-container-wrapper').classList.remove('show');
			overlay.classList.remove('active');
		});

		catalogTrigger.querySelector('.catalog-mobile-trigger').addEventListener('click', () => {
			catalogTrigger.querySelector('.header-item-icon-arrow-down').classList.toggle('active');
		})
	});
}

function moveTitles() {
	const isMobile = window.innerWidth < 860;
	document.querySelectorAll('.catalog-item-group').forEach(group => {
		const title = group.querySelector('.catalog-item-group-title');
		const titleWrapper = group.querySelector('.catalog-item-group__title');

		if (isMobile) {
			// Добавляем заголовок в titleWrapper
			if (!titleWrapper.contains(title)) {
				titleWrapper.appendChild(title);
				group.querySelector('.catalog-item-group__title-wrapper').setAttribute('data-spoller', '');
			}
		} else {
			// Возвращаем заголовок на место
			const content = group.querySelector('.catalog-item-group__content');
			if (!content.contains(title)) {
				content.insertBefore(title, content.firstChild);
				group.querySelector('.catalog-item-group__title-wrapper').removeAttribute('data-spoller');
			}
		}
	});

	if (window.innerWidth > 860) {
		document.querySelector('.catalog-mobile-trigger').removeAttribute('data-spoller');
	} else {
		document.querySelector('.catalog-mobile-trigger').setAttribute('data-spoller', '');
	}

	// Повторная инициализация спойлеров
	spollers();
}

async function resize() {
	// initSwipers();
	scroll();
	catalogLogic();
	catalogContainerWidth();
	moveTitles();
	productSlider();
}

function searchHeader() {
	const searchInputContainer = document.querySelector('.header-search-input-wrapper');
	const searchInput = searchInputContainer.querySelector('.header-search-input__input');
	const searchResultContainer = searchInputContainer.querySelector('.header-search-result');
	const headerCenter = document.querySelector('.header .header-center')

	let debounceTimer;

	// Функция для подсветки текста
	function highlightMatch(text, query) {
		const regex = new RegExp(`(${query})`, 'gi');
		return text.replace(regex, '<span style="color: blue;">$1</span>');
	}

	// Функция для выполнения поиска
	function performSearch(query) {
		if (query.length < 2) {
			searchResultContainer.innerHTML = '';
			searchResultContainer.classList.remove('show');
			return;
		}

		// AJAX-запрос
		fetch(abedulSearch.ajaxurl, {
			method: 'POST',
			headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
			body: new URLSearchParams({
				action: 'abedul_search',
				nonce: abedulSearch.nonce,
				query: query
			})
		})
			.then(response => response.json())
			.then(data => {
				searchResultContainer.innerHTML = '';
				if (data.success && data.data.length > 0) {
					data.data.forEach(product => {
						const resultItem = document.createElement('div');
						resultItem.classList.add('header-search-result-item');
						headerCenter.classList.add('open-search');
						resultItem.innerHTML = highlightMatch(product.title, query);
						resultItem.addEventListener('click', () => {
							window.location.href = product.url;
						});
						searchResultContainer.appendChild(resultItem);
					});
				} else {
					const noResults = document.createElement('div');
					noResults.classList.add('header-search-result-item');

					let emptyResult = '';
					if (currentLanguage === "en") {
						emptyResult = "Nothing found"; // Английская версия
					} else if (currentLanguage === "ru") {
						emptyResult = "Ничего не найдено"; // Русская версия
					} else if (currentLanguage === "zh") {
						emptyResult = "未找到"; // Русская версия
					}
					noResults.textContent = emptyResult;
					searchResultContainer.appendChild(noResults);
				}
				searchResultContainer.classList.add('show');
			});
	}

	// Событие ввода текста
	searchInput.addEventListener('input', () => {
		const query = searchInput.value.trim();

		clearTimeout(debounceTimer);
		debounceTimer = setTimeout(() => {
			if (query.length) {
				headerCenter.classList.add('open-search');
			}
			performSearch(query);
		}, 500); // Задержка в 500 мс
	});

	// Скрытие результатов при пустом вводе
	searchInput.addEventListener('blur', () => {
		setTimeout(() => {
			searchResultContainer.classList.remove('show');
			headerCenter.classList.remove('open-search');
		}, 200);
	});
}

function sideBarElements() {
	const sidebarItems = document.querySelectorAll('.side-bar-item');
	if (sidebarItems.length) {
		sidebarItems.forEach(item => {
			const subcontent = item.querySelector('.side-bar-item__subcontent');

			item.addEventListener('mouseenter', () => {
				subcontent?.classList.add('visible');
			});

			item.addEventListener('mouseleave', () => {
				if (!item.matches(':hover') && !subcontent?.matches(':hover')) {
					subcontent?.classList.remove('visible');
				}
			});
		});
	}
}

function initSwipers() {
	mainTopSlider = new Swiper('.main-top-slider', {
		slidesPerView: 1,
		spaceBetween: 0,
		loop: false,
		effect: 'fade',
		autoHeight: true,
		centeredSlides: false,
		autoplay: {
			delay: 3000
		},
		pagination: {
			el: ".main-top-slider-pagination",
			dynamicBullets: true,
			clickable: true
		},
		// navigation: {
		// 	nextEl: '.main-top-slider-r',
		// 	prevEl: '.main-top-slider-l',
		// },
	});

	const productSliders = document.querySelectorAll('.product-slider');

	productSliders.forEach((slider) => {
		const slides = slider.querySelectorAll('.swiper-slide');

		if (slides.length > 1) {
			new Swiper(slider, {
				loop: true,
				pagination: {
					el: slider.querySelector('.swiper-pagination'),
					dynamicBullets: true,
					clickable: true
				},
			});
		} else {
			slider.classList.add('no-swiper');
		}
	});


	// 1. Основной слайдер
	const mainClientsItems = document.querySelectorAll('.main-page-clients-item');
	const mainClientsContainer = document.querySelector('.main-page-clients-items');


	if (mainClientsItems.length >= 2) {
		new Swiper(mainClientsContainer, {
			spaceBetween: 12,
			loop: false,
			autoHeight: true,
			dynamicBullets: true,
			breakpoints: {
				// Для мобильных устройств до 860px
				860: {
					slidesPerView: 1,
					spaceBetween: 10, // (Опционально) уменьшить отступы
				},
				// Для устройств с шириной 1200px и выше
				1200: {
					slidesPerView: 2,
					spaceBetween: 12,
				},
			},
		});
	}

	// 2. Внутренние слайдеры
	const internalSliders = document.querySelectorAll('.main-page-clients-item__slider');

	internalSliders.forEach((slider) => {
		const slides = slider.querySelectorAll('.swiper-slide');


		// Если внутри есть больше одного слайда, инициализировать Swiper
		if (slides.length > 1) {
			new Swiper(slider, {
				slidesPerView: 1,
				spaceBetween: 10,
				loop: false,
				autoHeight: true,
				dynamicBullets: true,
				navigation: {
					nextEl: slider.querySelector('.control-right'),
					prevEl: slider.querySelector('.control-left'),
				},
				spaceBetween: 0,
			});
		} else {
			slider.classList.add('no-swiper'); // Добавляем класс, если слайдер не нужен
		}
	});
}

async function scroll() {
	if (window.innerWidth < 860) {
		document.querySelector('.header-bottom').classList.add('active');
		return;
	}
	if (window.scrollY >= 495) {
		document.querySelector('.header-bottom').classList.add('active');
	} else {
		document.querySelector('.header-bottom').classList.remove('active');
	}

	catalogContainerWidth();
}

async function loadPage() {
	await new Promise(resolve => window.addEventListener('load', resolve));
	await document.querySelector('body').classList.remove('preload');
	await document.querySelector('body').classList.remove('lock');
	const lazyImages = document.querySelectorAll('img[loading="lazy"]');

	if ("IntersectionObserver" in window) {
		const imageObserver = new IntersectionObserver((entries, observer) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting) {
					const img = entry.target;
					img.src = img.dataset.src;
					img.removeAttribute('loading');
					imageObserver.unobserve(img);
				}
			});
		});

		lazyImages.forEach((img) => {
			img.dataset.src = img.src;
			img.src = '';
			imageObserver.observe(img);
		});
	} else {
		// Fallback for browsers without IntersectionObserver support
		lazyImages.forEach((img) => {
			img.src = img.src; // Load all images immediately
		});
	}
}

async function video() {
	const videoPlayer = document.getElementById('videoPlayer');
	const videoSource = document.getElementById('videoSource');
	const playButton = document.getElementById('playButton');
	const prevButton = document.getElementById('prevButton');
	const nextButton = document.getElementById('nextButton');
	const videoLinks = document.querySelectorAll('.culture-video-prevue');
	const videoTiktokLink = document.querySelector('.video-tiktok-link');
	let currentVideoIndex = 0;

	if (videoPlayer) {
		// Function to set video source and play
		function setVideoSource(index) {
			const videoLink = videoLinks[index];
			const videoSrc = videoLink.getAttribute('data-video');
			videoTiktokLink.href = videoLink.getAttribute('data-tiktok-link');
			videoSource.src = videoSrc;
			videoPlayer.load();
			videoPlayer.play();
			currentVideoIndex = index;
		}

		// Event listener for video preview clicks
		videoLinks.forEach((link, index) => {
			link.addEventListener('click', (event) => {
				event.preventDefault();
				setVideoSource(index);
			});
		});

		// Event listener for play button
		playButton.addEventListener('click', (event) => {
			event.stopPropagation();
			if (videoPlayer.paused) {
				videoPlayer.play();
				playButton.innerHTML = `<img src="img/icons/player/pause.svg" alt="pause">`;
			} else {
				videoPlayer.pause();
				playButton.innerHTML = `<img src="img/icons/player/play.svg" alt="play">`;
			}
		});

		videoPlayer.addEventListener('play', () => {
			playButton.innerHTML = `<img src="img/icons/player/pause.svg" alt="pause">`;
		});

		videoPlayer.addEventListener('pause', () => {
			playButton.innerHTML = `<img src="img/icons/player/play.svg" alt="play">`;
		});

		// Event listener for prev button
		prevButton.addEventListener('click', (event) => {
			event.stopPropagation();
			if (currentVideoIndex > 0) {
				setVideoSource(currentVideoIndex - 1);
			} else {
				setVideoSource(videoLinks.length - 1); // Loop back to the last video
			}
		});

		// Event listener for next button
		nextButton.addEventListener('click', (event) => {
			event.stopPropagation();
			if (currentVideoIndex < videoLinks.length - 1) {
				setVideoSource(currentVideoIndex + 1);
			} else {
				setVideoSource(0); // Loop back to the first video
			}
		});
	}
}

async function anchors() {
	const anchors = document.querySelectorAll('.redirect-el');
	if (anchors) {
		for (let anchor of anchors) {
			anchor.addEventListener('click', function (e) {
				e.preventDefault();

				const blockID = anchor.getAttribute('href').split('#')[1];
				const targetBlock = document.getElementById(blockID);

				if (targetBlock) {
					targetBlock.scrollIntoView({
						behavior: 'smooth',
						block: 'start'
					})
					if (targetBlock.getAttribute('id') === 'faq') {
						setTimeout(() => {
							document.querySelector('.question-block').click();
						}, 1000);
					}
				}
				history.replaceState(null, null, ' ');
			});
		}
	}
}

async function checkClick() {
	document.addEventListener('click', (e) => {
		const element = e.target.closest('[data-event-label]'); // Отлавливаем элементы с data-event-label или классом redirect-el
		if (element) {
			const eventLabel = element.getAttribute('data-event-label') || 'Unnamed Element';
			gtag('event', 'click', {
				event_label: eventLabel,
				event_category: 'User Interaction',
				event_action: 'click'
			});
		}
	});
}

function trackScroll() {
	const sections = document.querySelectorAll(
		'#main-block, #action, #about, #culture, #jobs'
	);
	const scrolledSections = new Set();
	const timers = new Map();

	// IntersectionObserver
	const observerOptions = {
		root: null,
		rootMargin: '0px',
		threshold: 0.5 // 50%
	};

	const observerCallback = (entries) => {
		entries.forEach((entry) => {
			const sectionId = entry.target.getAttribute('id') || 'unnamed-section';

			if (entry.isIntersecting) {
				if (!timers.has(sectionId)) {
					const timer = setTimeout(() => {
						if (!scrolledSections.has(sectionId)) {
							scrolledSections.add(sectionId);
							gtag('event', 'scroll_to_section', {
								section: sectionId,
								event_label: `Scrolled to ${sectionId}`,
								event_category: 'Navigation',
								non_interaction: true
							});
						}
						timers.delete(sectionId);
					}, 300);
					timers.set(sectionId, timer);
				}
			} else {
				if (timers.has(sectionId)) {
					clearTimeout(timers.get(sectionId));
					timers.delete(sectionId);
				}
			}
		});
	};

	const observer = new IntersectionObserver(observerCallback, observerOptions);

	sections.forEach((section) => {
		observer.observe(section);
	});

	window.addEventListener('beforeunload', () => {
		scrolledSections.clear();
		timers.clear();
	});
}

async function form() {
	// const form = document.getElementById('contact-form');
	const forms = document.querySelectorAll('.form');
	forms.forEach((form) => {
		if (form) {
			let countryData = '';
			const inputPhone = form.querySelector(".form-item-input-phone");
			const iti = window.intlTelInput(inputPhone, {
				initialCountry: "ru",
				utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@24.0.1/build/js/utils.js",
			});

			inputPhone.addEventListener('countrychange', function () {
				countryData = iti.getSelectedCountryData();
			});

			let fileInput = document.getElementById('fileUpload');
			let fileLabel = document.querySelector('.form-item-file-label');
			let fileRemove = document.querySelector('.form-item-file-remove');

			if (fileInput) {
				fileInput.addEventListener('change', function () {
					let fileName = fileInput.files[0] ? fileInput.files[0].name : 'Upload File';
					fileLabel.textContent = fileName;

					if (fileInput.files[0]) {
						fileRemove.style.display = 'block';
					} else {
						fileRemove.style.display = 'none';
					}
				});
			}

			if (fileRemove) {
				fileRemove.addEventListener('click', function () {
					fileInput.value = "";
					fileLabel.textContent = 'Upload File';
					fileRemove.style.display = 'none';
				});
			}

			initializeFormValidation(null, [], countryData.dialCode ? countryData.dialCode : '7');
			form.querySelector('.btn').addEventListener('click', async () => {
				const formData = initializeFormValidation(form, [], countryData.dialCode ? countryData.dialCode : '7');
				console.log('formData:', formData);
				if (formData) {
					const formBody = new FormData();
					for (const key in formData) {
						if (formData.hasOwnProperty(key)) {
							formBody.append(key, formData[key]);
						}
					}

					// request sending
					form.closest('.form-wrapper')?.classList.add('load');
					if (form.classList.contains('form-popup')) {
						popupClose(form.closest('.popup'));
						body.classList.add('load');
					}

					// Отправка данных на сервер
					const response = await fetch('/wp-json/send-form/send', {
						method: 'POST',
						body: formBody
					});

					const result = await response.json();
					if (result.success) {
						form.closest('.form-wrapper')?.classList.remove('load');
						form.closest('.form-wrapper')?.querySelector('.form-sending')?.classList.add('active');

						if (form.classList.contains('form-popup')) {
							popupOpen(document.querySelector('.confirm-send-form'));
							body.classList.remove('load');
						}

						form.reset();
					} else {
						console.error('Error sending form', result.error);
					}
				} else {
					// some form fields did not pass validation
				}
			})
		}
	})
}

function catalogContainerWidth() {
	if (window.innerWidth > 860) {
		// Проверяем, найден ли элемент
		if (document.querySelector('.header-bottom .header-scroll-items')) {
			const containerWidth = document.querySelector('.header-bottom .header-scroll-items').getBoundingClientRect().width - 0; // Получаем ширину элемента

			// Устанавливаем ширину для catalogContainer
			document.getElementById('catalog-container-wrapper').style.width = `${containerWidth}px`;
		} else {
			// console.error('headerBottomContainer не найден');
		}
	}
}

function dynamicAdapt() {
	function DynamicAdapt(type) {
		this.type = type;
	}

	DynamicAdapt.prototype.init = function () {
		const _this = this;
		this.оbjects = [];
		this.daClassname = "_dynamic_adapt_";
		this.nodes = document.querySelectorAll("[data-da]");

		for (let i = 0; i < this.nodes.length; i++) {
			const node = this.nodes[i];
			const data = node.dataset.da.trim();
			const dataArray = data.split(",");
			const оbject = {};
			оbject.element = node;
			оbject.parent = node.parentNode;
			оbject.destination = document.querySelector(dataArray[0].trim());
			оbject.breakpoint = dataArray[1] ? dataArray[1].trim() : "767";
			оbject.place = dataArray[2] ? dataArray[2].trim() : "last";
			оbject.index = this.indexInParent(оbject.parent, оbject.element);
			this.оbjects.push(оbject);
		}

		this.arraySort(this.оbjects);

		this.mediaQueries = Array.prototype.map.call(this.оbjects, function (item) {
			return '(' + this.type + "-width: " + item.breakpoint + "px)," + item.breakpoint;
		}, this);
		this.mediaQueries = Array.prototype.filter.call(this.mediaQueries, function (item, index, self) {
			return Array.prototype.indexOf.call(self, item) === index;
		});

		for (let i = 0; i < this.mediaQueries.length; i++) {
			const media = this.mediaQueries[i];
			const mediaSplit = String.prototype.split.call(media, ',');
			const matchMedia = window.matchMedia(mediaSplit[0]);
			const mediaBreakpoint = mediaSplit[1];

			const оbjectsFilter = Array.prototype.filter.call(this.оbjects, function (item) {
				return item.breakpoint === mediaBreakpoint;
			});
			matchMedia.addListener(function () {
				_this.mediaHandler(matchMedia, оbjectsFilter);
			});
			this.mediaHandler(matchMedia, оbjectsFilter);
		}
	};

	DynamicAdapt.prototype.mediaHandler = function (matchMedia, оbjects) {
		if (matchMedia.matches) {
			for (let i = 0; i < оbjects.length; i++) {
				const оbject = оbjects[i];
				оbject.index = this.indexInParent(оbject.parent, оbject.element);
				this.moveTo(оbject.place, оbject.element, оbject.destination);
			}
		} else {
			for (let i = 0; i < оbjects.length; i++) {
				const оbject = оbjects[i];
				if (оbject.element.classList.contains(this.daClassname)) {
					this.moveBack(оbject.parent, оbject.element, оbject.index);
				}
			}
		}
	};

	DynamicAdapt.prototype.moveTo = function (place, element, destination) {
		element.classList.add(this.daClassname);
		if (place === 'last' || place >= destination.children.length) {
			destination.insertAdjacentElement('beforeend', element);
			return;
		}
		if (place === 'first') {
			destination.insertAdjacentElement('afterbegin', element);
			return;
		}
		destination.children[place].insertAdjacentElement('beforebegin', element);
	}

	DynamicAdapt.prototype.moveBack = function (parent, element, index) {
		element.classList.remove(this.daClassname);
		if (parent.children[index] !== undefined) {
			parent.children[index].insertAdjacentElement('beforebegin', element);
		} else {
			parent.insertAdjacentElement('beforeend', element);
		}
	}

	DynamicAdapt.prototype.indexInParent = function (parent, element) {
		const array = Array.prototype.slice.call(parent.children);
		return Array.prototype.indexOf.call(array, element);
	};

	DynamicAdapt.prototype.arraySort = function (arr) {
		if (this.type === "min") {
			Array.prototype.sort.call(arr, function (a, b) {
				if (a.breakpoint === b.breakpoint) {
					if (a.place === b.place) {
						return 0;
					}

					if (a.place === "first" || b.place === "last") {
						return -1;
					}

					if (a.place === "last" || b.place === "first") {
						return 1;
					}

					return a.place - b.place;
				}

				return a.breakpoint - b.breakpoint;
			});
		} else {
			Array.prototype.sort.call(arr, function (a, b) {
				if (a.breakpoint === b.breakpoint) {
					if (a.place === b.place) {
						return 0;
					}

					if (a.place === "first" || b.place === "last") {
						return 1;
					}

					if (a.place === "last" || b.place === "first") {
						return -1;
					}

					return b.place - a.place;
				}

				return b.breakpoint - a.breakpoint;
			});
			return;
		}
	};

	const da = new DynamicAdapt("max");
	da.init();
}

function langSelect() {
	// 	const select = document.querySelector('.header-language');
	// 	const selectTrigger = document.querySelector('.selected-option');
	// 	const selectOptionsImg = document.querySelector('.lang-arrow');
	// 	const selectedOption = select.querySelector('.lang-value');
	// 	const options = select.querySelector('.options');

	// 	// Устанавливаем язык из localStorage при загрузке страницы
	// 	const storedLang = localStorage.getItem('selectedLanguage');
	// 	if (storedLang) {
	// 		selectedOption.textContent = storedLang;
	// 		updateOptions(storedLang);
	// 	}

	// 	selectTrigger.addEventListener('click', () => {
	// 		options.classList.toggle('active');
	// 		selectOptionsImg.classList.toggle('active');
	// 	});

	// 	options.addEventListener('click', (e) => {
	// 		if (e.target.tagName === 'LI') {
	// 			let newLang_n = e.target.textContent.toLowerCase(); // Получаем выбранный язык
	// 			console.log(newLang_n);

	// 			if (newLang_n == "中文") {
	// 				newLang_n = 'zh';
	// 				console.log(newLang_n);
	// 			}

	// 			if (newLang_n) {
	// 				document.cookie = `pll_language=${newLang_n}; path=/; max-age=31536000`; // Cookie на 1 год
	// 			}

	// 			let currentPath = window.location.pathname;
	// 			console.log('currentPath', currentPath);

	// 			let pathParts = currentPath.split('/').filter(Boolean); // Разбиваем путь на части и убираем пустые элементы

	// 			const supportedLanguages = ['en', 'zh', 'ru']; // Список поддерживаемых языков

	// 			// Если есть префикс, удаляем его
	// 			if (supportedLanguages.includes(pathParts[0])) {
	// 				pathParts.shift(); // Убираем текущий языковой префикс
	// 			}
	// 			// Проверяем и удаляем суффикс, если он присутствует
	// 			let suffixPattern = /-(\d+)$/; // Регулярное выражение для поиска суффикса в конце URL
	// 			if (suffixPattern.test(pathParts[pathParts.length - 1])) {
	// 				pathParts[pathParts.length - 1] = pathParts[pathParts.length - 1].replace(suffixPattern, ''); // Убираем суффикс
	// 			}
	// 			// Добавляем суффикс в зависимости от выбранного языка
	// 			let suffix = '';
	// 			if (newLang_n === 'en') {
	// 				suffix = '-en'; // Для английского языка добавляем en
	// 			} else if (newLang_n === 'zh') {
	// 				suffix = '-zh'; // Для китайского языка добавляем -3
	// 			} else if (newLang_n === 'ru') {
	// 				suffix = ''; // Для русского языка добавляем
	// 			}
	// 			// Формируем новый путь с префиксом языка и суффиксом
	// 			let newPath = '/' + pathParts.join('/') + suffix;

	// 			console.log('newPath', newPath); // Для отладки
	// 			// Переходим на новый URL
	// 			// window.location.href = newPath;


	// 			const newLang = e.target.textContent;

	// 			// Обновляем выбранный язык
	// 			selectedOption.textContent = newLang;

	// 			// Сохраняем выбранный язык в localStorage
	// 			localStorage.setItem('selectedLanguage', newLang);

	// 			// Выводим в консоль выбранный язык
	// 			console.log(`Выбранный язык: ${newLang}`);

	// 			// Обновляем список доступных опций
	// 			updateOptions(newLang);

	// 			options.classList.remove('active');
	// 			selectOptionsImg.classList.remove('active');
	// 		}
	// 	});

	// 	document.addEventListener('click', (e) => {
	// 		if (!select.contains(e.target)) {
	// 			options.classList.remove('active');
	// 			selectOptionsImg.classList.remove('active');
	// 		}
	// 	});

	// 	// Функция для обновления списка доступных опций
	// 	function updateOptions(currentLang) {
	// 		const allOptions = ['RU', 'EN', '中文'];
	// 		options.innerHTML = '';

	// 		// Генерируем опции, исключая текущий язык
	// 		allOptions
	// 			.filter(lang => lang !== currentLang)
	// 			.forEach(lang => {
	// 				const li = document.createElement('li');
	// 				li.textContent = lang;
	// 				li.dataset.lang = lang.toLowerCase();
	// 				options.appendChild(li);
	// 			});
	// 	}
	// }

	// if (window.innerWidth < 960) {
	// 	if (!swiperActions) { // Если Swiper ещё не инициализирован
	// 		swiperActions = new Swiper('.main-top-slider', {
	// 			slidesPerView: 1.5,
	// 			spaceBetween: 0,
	// 			loop: false,
	// 			autoHeight: true,
	// 			centeredSlides: true,
	// 			navigation: {
	// 				nextEl: '.actions-swiper-r',
	// 				prevEl: '.actions-swiper-l',
	// 			},
	// 		});
	// 	}
	// } else {
	// 	if (swiperActions) { // Если Swiper уже существует и ширина больше 960
	// 		swiperActions.destroy(); // Уничтожаем Swiper
	// 		swiperActions = null;
	// 	}
}

function headerMenu() {
	// menuMobile_s
	let delay = 500;
	let iconMenu = document.querySelector(".icon-menu");
	let menuMobile = document.querySelector(".menu__mobile");
	let headerSearch = document.querySelector(".header-search");
	let headerSearchClose = document.querySelector(".header-search-input__close");
	let menuLinks = document.querySelectorAll(".menu-link-trigger");
	let mobileSearchWrapper = document.querySelector('.header-mobile-container .header-search-input-wrapper');
	headerSearch.addEventListener("click", function () {
		mobileSearchWrapper.classList.add('show');
	})
	headerSearchClose.addEventListener("click", function () {
		mobileSearchWrapper.classList.remove('show');
	})
	menuLinks?.forEach(element => {
		// element.preventDefault();
		element.addEventListener("click", function () {
			body_lock_remove(delay)
			iconMenu.classList.remove("active");
			menuMobile.classList.remove("active");
		})
	});

	iconMenu?.addEventListener("click", function (e) {
		if (unlock) {
			body_lock(delay);
			if (window.innerWidth <= 990) {
				body_lock(delay);
			}
			iconMenu.classList.toggle("active");
			menuMobile.classList.toggle("active");
			// headerSearch.classList.toggle("hide");
		}
	});

	function body_lock(delay) {
		if (body.classList.contains('lock')) {
			body_lock_remove(delay);
		} else {
			body_lock_add(delay);
		}
	}
	function body_lock_remove(delay) {
		let body = document.querySelector("body");
		if (unlock) {
			let lock_padding = document.querySelectorAll("._lp");
			setTimeout(() => {
				for (let index = 0; index < lock_padding.length; index++) {
					const el = lock_padding[index];
					el.style.paddingRight = '0px';
				}
				body.style.paddingRight = '0px';
				body.classList.remove("lock");
			}, delay);

			unlock = false;
			setTimeout(function () {
				unlock = true;
			}, delay);
		}
	}
	function body_lock_add(delay) {
		let body = document.querySelector("body");
		if (unlock) {
			let lock_padding = document.querySelectorAll("._lp");
			for (let index = 0; index < lock_padding.length; index++) {
				const el = lock_padding[index];
				el.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
			}
			body.style.paddingRight = window.innerWidth - document.querySelector('.wrapper').offsetWidth + 'px';
			body.classList.add("lock");

			unlock = false;
			setTimeout(function () {
				unlock = true;
			}, delay);
		}
	}
}

function spollers() {
	//=================
	/*
	Для родителя слойлеров пишем атрибут data-spollers
	Для заголовков слойлеров пишем атрибут data-spoller
	Если нужно включать\выключать работу спойлеров на разных размерах экранов
	пишем параметры ширины и типа брейкпоинта.
	Например: 
	data-spollers="992,max" - спойлеры будут работать только на экранах меньше или равно 992px
	data-spollers="768,min" - спойлеры будут работать только на экранах больше или равно 768px
	
	Если нужно что бы в блоке открывался болько один слойлер добавляем атрибут data-one-spoller
	*/

	//=================
	//=================
	//SlideToggle
	let _slideUp = (target, duration = 500) => {
		if (!target.classList.contains('_slide')) {
			target.classList.add('_slide');
			target.style.transitionProperty = 'height, margin, padding';
			target.style.transitionDuration = duration + 'ms';
			target.style.height = target.offsetHeight + 'px';
			target.offsetHeight;
			target.style.overflow = 'hidden';
			target.style.height = 0;
			target.style.paddingTop = 0;
			target.style.paddingBottom = 0;
			target.style.marginTop = 0;
			target.style.marginBottom = 0;
			window.setTimeout(() => {
				target.hidden = true;
				target.style.removeProperty('height');
				target.style.removeProperty('padding-top');
				target.style.removeProperty('padding-bottom');
				target.style.removeProperty('margin-top');
				target.style.removeProperty('margin-bottom');
				target.style.removeProperty('overflow');
				target.style.removeProperty('transition-duration');
				target.style.removeProperty('transition-property');
				target.classList.remove('_slide');
			}, duration);
		}
	}
	let _slideDown = (target, duration = 500) => {
		if (!target.classList.contains('_slide')) {
			target.classList.add('_slide');
			if (target.hidden) {
				target.hidden = false;
			}
			let height = target.offsetHeight;
			target.style.overflow = 'hidden';
			target.style.height = 0;
			target.style.paddingTop = 0;
			target.style.paddingBottom = 0;
			target.style.marginTop = 0;
			target.style.marginBottom = 0;
			target.offsetHeight;
			target.style.transitionProperty = "height, margin, padding";
			target.style.transitionDuration = duration + 'ms';
			target.style.height = height + 'px';
			target.style.removeProperty('padding-top');
			target.style.removeProperty('padding-bottom');
			target.style.removeProperty('margin-top');
			target.style.removeProperty('margin-bottom');
			window.setTimeout(() => {
				target.style.removeProperty('height');
				target.style.removeProperty('overflow');
				target.style.removeProperty('transition-duration');
				target.style.removeProperty('transition-property');
				target.classList.remove('_slide');
			}, duration);
		}
	}
	let _slideToggle = (target, duration = 500) => {
		if (target.hidden) {
			return _slideDown(target, duration);
		} else {
			return _slideUp(target, duration);
		}
	}
	//========================================
	//Wrap
	function _wrap(el, wrapper) {
		el.parentNode.insertBefore(wrapper, el);
		wrapper.appendChild(el);
	}
	//========================================
	//RemoveClasses
	function _removeClasses(el, class_name) {
		for (var i = 0; i < el.length; i++) {
			el[i].classList.remove(class_name);
		}
	}
	//========================================
	//IsHidden
	function _is_hidden(el) {
		return (el.offsetParent === null)
	}

	// SPOLLERS
	const spollersArray = document.querySelectorAll('[data-spollers]');
	if (spollersArray.length > 0) {
		// Получение обычных слойлеров
		const spollersRegular = Array.from(spollersArray).filter(function (item, index, self) {
			return !item.dataset.spollers.split(",")[0];
		});
		// Инициализация обычных слойлеров
		if (spollersRegular.length > 0) {
			initSpollers(spollersRegular);
		}

		// Получение слойлеров с медиа запросами
		const spollersMedia = Array.from(spollersArray).filter(function (item, index, self) {
			return item.dataset.spollers.split(",")[0];
		});

		// Инициализация слойлеров с медиа запросами
		if (spollersMedia.length > 0) {
			const breakpointsArray = [];
			spollersMedia.forEach(item => {
				const params = item.dataset.spollers;
				const breakpoint = {};
				const paramsArray = params.split(",");
				breakpoint.value = paramsArray[0];
				breakpoint.type = paramsArray[1] ? paramsArray[1].trim() : "max";
				breakpoint.item = item;
				breakpointsArray.push(breakpoint);
			});

			// Получаем уникальные брейкпоинты
			let mediaQueries = breakpointsArray.map(function (item) {
				return '(' + item.type + "-width: " + item.value + "px)," + item.value + ',' + item.type;
			});
			mediaQueries = mediaQueries.filter(function (item, index, self) {
				return self.indexOf(item) === index;
			});

			// Работаем с каждым брейкпоинтом
			mediaQueries.forEach(breakpoint => {
				const paramsArray = breakpoint.split(",");
				const mediaBreakpoint = paramsArray[1];
				const mediaType = paramsArray[2];
				const matchMedia = window.matchMedia(paramsArray[0]);

				// Объекты с нужными условиями
				const spollersArray = breakpointsArray.filter(function (item) {
					if (item.value === mediaBreakpoint && item.type === mediaType) {
						return true;
					}
				});
				// Событие
				matchMedia.addListener(function () {
					initSpollers(spollersArray, matchMedia);
				});
				initSpollers(spollersArray, matchMedia);
			});
		}
		// Инициализация
		function initSpollers(spollersArray, matchMedia = false) {
			spollersArray.forEach(spollersBlock => {
				spollersBlock = matchMedia ? spollersBlock.item : spollersBlock;
				if (matchMedia.matches || !matchMedia) {
					spollersBlock.classList.add('_init');
					initSpollerBody(spollersBlock);
					spollersBlock.addEventListener("click", setSpollerAction);
				} else {
					spollersBlock.classList.remove('_init');
					initSpollerBody(spollersBlock, false);
					spollersBlock.removeEventListener("click", setSpollerAction);
				}
			});
		}
		// Работа с контентом
		function initSpollerBody(spollersBlock, hideSpollerBody = true) {
			const spollerTitles = spollersBlock.querySelectorAll('[data-spoller]');
			if (spollerTitles.length > 0) {
				spollerTitles.forEach(spollerTitle => {
					if (hideSpollerBody) {
						spollerTitle.removeAttribute('tabindex');
						if (!spollerTitle.classList.contains('_active')) {
							spollerTitle.nextElementSibling.hidden = true;
						}
					} else {
						spollerTitle.setAttribute('tabindex', '-1');
						spollerTitle.nextElementSibling.hidden = false;
					}
				});
			}
		}
		function setSpollerAction(e) {
			const el = e.target;

			if (!el.hasAttribute('none-target-spoller')) {
				if (el.hasAttribute('data-spoller') || el.closest('[data-spoller]')) {
					const spollerTitle = el.hasAttribute('data-spoller') ? el : el.closest('[data-spoller]');
					const spollersBlock = spollerTitle.closest('[data-spollers]');
					const oneSpoller = spollersBlock.hasAttribute('data-one-spoller') ? true : false;
					if (!spollersBlock.querySelectorAll('._slide').length) {
						if (oneSpoller && !spollerTitle.classList.contains('_active')) {
							hideSpollersBody(spollersBlock);
						}
						spollerTitle.classList.toggle('_active');
						_slideToggle(spollerTitle.nextElementSibling, 500);
					}
					e.preventDefault();
				}
			}
		}
		function hideSpollersBody(spollersBlock) {
			const spollerActiveTitle = spollersBlock.querySelector('[data-spoller]._active');
			if (spollerActiveTitle) {
				spollerActiveTitle.classList.remove('_active');
				_slideUp(spollerActiveTitle.nextElementSibling, 500);
			}
		}
	}
}

function productSlider() {
	// Инициализация слайдера для миниатюр
	const sliderThumbs = new Swiper('.product-slider__thumbs', {
		direction: 'vertical',
		slidesPerView: 5,
		spaceBetween: 10,
		freeMode: true,
		navigation: {
			nextEl: '.product-slider__thumb-nav--down',
			prevEl: '.product-slider__thumb-nav--up'
		},
		breakpoints: {
			0: {
				slidesPerView: 3,
				direction: 'vertical', // Горизонтальная прокрутка на маленьких экранах
			},
			1300: {
				slidesPerView: 5,
				direction: 'vertical'
			}
		}
	});

	// Инициализация основного слайдера
	const sliderMain = new Swiper('.product-slider-main', {
		slidesPerView: 1,
		spaceBetween: 32,
		mousewheel: true,
		grabCursor: false,
		// effect: 'fade',
		thumbs: {
			swiper: sliderThumbs,
		},
		navigation: {
			nextEl: '.product-slider__thumb-nav--down',
			prevEl: '.product-slider__thumb-nav--up'
		},
		breakpoints: {
			0: {
				// centeredSlides: true,
				// slidesPerView: 1.2,
				direction: 'horizontal',
				navigation: {
					nextEl: '.product-slider-main-controls .control-right',
					prevEl: '.product-slider-main-controls .control-left'
				},
			},
			768: {
				navigation: {
					nextEl: '.product-slider-main-controls .control-right',
					prevEl: '.product-slider-main-controls .control-left'
				},
			},
			860: {
				slidesPerView: 1
			}
		}
	});

	document.querySelectorAll('.tab-link').forEach(tab => {
		tab.addEventListener('click', () => {
			const tabName = tab.dataset.tab;

			// Убираем класс active у всех табов
			document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
			// Добавляем класс active на кликнутый таб
			tab.classList.add('active');

			// Скрываем все панели
			document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
			// Показываем соответствующую панель
			document.querySelector(`.tab-pane.${tabName}`).classList.add('active');
		});
	});
}

function renderProducts(products, container) {
	// container.innerHTML = products.map(product => `
	//     <div class="product-item">
	//         <div class="product-slider swiper">
	// 			<div class="swiper-wrapper">
	// 				${product.images.map(image => `<div class="swiper-slide"><img src="${image}" alt="${product.name}"></div>`).join("")}
	// 			</div>
	// 			<div class="swiper-pagination"></div>
	//         </div>
	//         <div class="product-info">
	//             <h3 class="product-title">${product.name}</h3>
	//             <p class="product-description">${product.description}</p>
	//             <p class="product-article">Артикул: ${product.article}</p>
	// 			<p class="product-description product-description-text">${product.descriptionText}</p>
	//             <div class="product-buttons">
	//                 <a href="product.php?id=${product.id}" class="btn btn-blue">Подробнее</a>
	// 				<a href="#order-send-popup" class="btn btn-white order-product-btn popup-link">Заказать</a>
	//             </div>
	//         </div>
	//     </div>
	// `).join("");
	// popupLinks = document.querySelectorAll('.popup-link');
	// updatePopupLinks();
};

function initCatalog() {
	initFilters();
}

function initFilters() {
	let debounceTimeout;
	const searchInput = document.querySelector('.catalog-search-input');
	const filterForm = document.querySelector('.filter-form');
	const filterClearButton = document.querySelector('.btn-clear-filter');
	const paginationButtons = document.querySelectorAll('.pagination-btn');

	// Очистка фильтров
	filterClearButton.addEventListener('click', (e) => {
		e.preventDefault();
		filterForm.reset();
		sendFilterData();
	});

	// Дебаунс для поиска
	function debounceSearch() {
		clearTimeout(debounceTimeout);
		debounceTimeout = setTimeout(() => {
			sendFilterData();
		}, 500);
	}

	searchInput.addEventListener('input', debounceSearch);

	filterForm.addEventListener('change', (e) => {
		e.preventDefault();
		sendFilterData();
	});

	// Обработка кликов по кнопкам пагинации
	paginationButtons.forEach(button => {
		button.addEventListener('click', (e) => {
			const currentPage = e.target.getAttribute('data-page');
			if (currentPage === 'prev' || currentPage === 'next') {
				const activePage = document.querySelector('.pagination-btn.active');
				const currentPageNum = parseInt(activePage.getAttribute('data-page'));

				if (currentPage === 'prev') {
					sendFilterData(currentPageNum - 1);
				} else if (currentPage === 'next') {
					sendFilterData(currentPageNum + 1);
				}
			} else {
				sendFilterData(currentPage);
			}
		});
	});

	function sendFilterData(currentPage = 1) {
		const formData = new FormData(filterForm);
		const searchValue = searchInput.value.trim();
		if (searchValue) {
			formData.append('product_name', searchValue);
		}

		formData.append('paged', currentPage);
		formData.append('action', 'my_filter_products');

		body.classList.add('loading');

		fetch('/wp-admin/admin-ajax.php', {
			method: 'POST',
			body: formData,
		})
			.then(response => response.json())
			.then(data => {
				const productsContainer = document.querySelector('.products-items');
				if (productsContainer) {
					productsContainer.innerHTML = data.html;
				}
				body.classList.remove('loading');

				// Обновляем пагинацию
				updatePagination(data.total_pages, currentPage);
				updatePopupLinks();
				initSwipers();

				// Переинициализируем fslightbox
				if (typeof refreshFsLightbox === 'function') {
					refreshFsLightbox();
				}
			})
			.catch(error => {
				console.error('Ошибка:', error);
				body.classList.remove('loading');
				updatePopupLinks();
				initSwipers();

				// Переинициализируем fslightbox
				if (typeof refreshFsLightbox === 'function') {
					refreshFsLightbox();
				}
			});
	}

	// Обновление пагинации
	function updatePagination(totalPages, currentPage) {
		const pagination = document.querySelector('.pagination');
		const buttons = pagination?.querySelectorAll('.pagination-btn');

		// Удаляем старые кнопки
		buttons?.forEach(button => button.remove());

		// Оставляем кнопки для текущих страниц
		for (let i = 1; i <= totalPages; i++) {
			let pageButton = document.createElement('button');
			if (pageButton) {
				pageButton.classList.add('pagination-btn');
				pageButton.setAttribute('data-page', i);
				pageButton.innerText = i;
				pagination?.insertBefore(pageButton, pagination.querySelector('.next'));
				pageButton.addEventListener('click', (e) => {
					const currentPage = e.target.getAttribute('data-page');
					sendFilterData(currentPage);
				});
			}
		}

		// Убираем старые активные кнопки
		buttons?.forEach(button => button.classList.remove('active'));

		// Устанавливаем активную кнопку
		const pageButton = pagination?.querySelector(`[data-page="${currentPage}"]`);
		if (pageButton) {
			pageButton.classList.add('active');
		}
	}

	sendFilterData();
}

function initViewType() {
	// Элементы переключателя и контейнер с товарами
	const viewSwitcher = document.querySelector(".view-types");
	const productsContainer = document.querySelector(".products-items");

	// Функция для установки типа отображения
	const setViewType = (viewType) => {
		// Удаляем предыдущие классы отображения
		productsContainer?.classList.remove("grid", "list");
		// Устанавливаем новый класс
		productsContainer?.classList.add(viewType);
		// Сохраняем выбор пользователя в localStorage
		localStorage.setItem("viewType", viewType);
		// Обновляем активный элемент в переключателе
		document.querySelectorAll(".view-type").forEach((type) => {
			type.classList.toggle("active", type.dataset.view === viewType);
		});
	};

	// Устанавливаем начальный тип отображения
	const initialViewType = localStorage.getItem("viewType") || "grid";
	setViewType(initialViewType);

	// Обработчик события для переключения
	viewSwitcher.addEventListener("click", (event) => {
		const target = event.target.closest(".view-type");
		if (target && target.dataset.view) {
			setViewType(target.dataset.view);
		}
	});
}

function catalogFlterMobile() {
	const filterBtn = document.querySelector('.catalog-sidebar-title');
	const filterForm = document.querySelector('.filter-form');
	const filterLabels = filterForm.querySelectorAll('.filter-group-label');

	// todo доработать фильтр в мобильной версии
	filterBtn.addEventListener('click', () => {
		filterForm.classList.toggle('active');
		filterBtn.classList.toggle('active');
	})

	if (window.innerWidth < 860) {
		filterLabels.forEach((filterLabel) => {
			filterLabel.setAttribute('data-spoller', '');
		})

		filterForm.setAttribute('data-spollers', '');
	} else {
		filterLabels.forEach((filterLabel) => {
			filterLabel.removeAttribute('data-spoller');
		})

		filterForm.removeAttribute('data-spollers');
	}

}

function initMap() {
	// Создаем карту
	var myMap = new ymaps.Map("map", {
		center: [cordinateX, cordinateY], // Координаты центра карты
		zoom: 16, // Масштаб карты
		controls: ['zoomControl'] // Убираем все стандартные элементы управления
	});

	// Создаем кастомную метку
	var myPlacemark = new ymaps.Placemark(
		[cordinateX, cordinateY], // Координаты метки
		{
			// Контент балуна
			balloonContent: `
                <div style="padding: 10px; font-size: 14px; font-family: Arial, sans-serif;">
                    <strong>г. Москва</strong><br>
                    ул. Дубнинская, д. 83<br>
                    8-й этаж №819-820-821
                </div>`
		},
		{
			// Настройки метки
			iconLayout: 'default#image',
			iconImageHref: logo_map, // Путь к кастомному изображению метки
			iconImageSize: [90, 40], // Размер иконки
			iconImageOffset: [-20, -40] // Смещение иконки
		}
	);

	// Добавляем метку на карту
	myMap.geoObjects.add(myPlacemark);

}

function downloadLogic() {
	const downloadButton = document.querySelector('.product-main-info__download');

	if (downloadButton) {
		downloadButton.addEventListener('click', function (e) {
			e.preventDefault();

			// Получаем данные товара
			const productName = document.querySelector('.product-main-info__title')?.textContent.trim() || 'Без названия';
			const productAttributes = document.querySelectorAll('.spec-list > li');

			// Создаем массив данных для Excel
			const excelData = [[productName], [], []];

			productAttributes.forEach(item => {
				const attributeName = item.querySelector('.spec-name')?.textContent.trim() || '';
				const attributeValue = item.querySelector('.spec-value')?.textContent.trim() || '';
				if (attributeName && attributeValue) {
					excelData.push([attributeName, attributeValue]);
				}
			});

			// Создаем книгу и лист Excel
			const worksheet = XLSX.utils.aoa_to_sheet(excelData);
			const workbook = XLSX.utils.book_new();
			XLSX.utils.book_append_sheet(workbook, worksheet, 'Характеристики');

			// Генерируем и скачиваем файл
			XLSX.writeFile(workbook, `${productName}.xlsx`);
		});
	}
}